# !/usr/bin/env python

from flask import Flask, session
from flask_github import GitHub
from flask_mongoengine import MongoEngine

from api_v1 import api_v1
from web import create_web_blueprint

app = Flask(__name__)
app.config.from_pyfile('app.cfg')
app.secret_key = app.config['SECRET_KEY']

app.db = MongoEngine(app)
app.github = GitHub(app)

def needs_login():
    return app.config['GITHUB_ORG'] is not None

def has_login():
    if not needs_login():
        return True

    return 'github_token' in session

app.needs_login = needs_login
app.has_login = has_login

web = create_web_blueprint(app)

app.register_blueprint(api_v1)
app.register_blueprint(web)
