{% extends "base.html" %}
{% block title %}{{ kernel.vendor }}/{{ kernel.device }} - LineageOS CVE Tracker{% endblock %}
{% block earlyscripts %}
    <script type="text/javascript">
        var pageData = {
            repo: "{{ kernel.repo }}",
            branchName: "{{ active_branch.name }}"
        };
    </script>
    <script src="/static/js/ContextMenu.js" type="text/javascript"></script>
    <script src="/static/js/ListView.js" type="text/javascript"></script>
    <script src="/static/js/Progress.js" type="text/javascript"></script>
    <link href="/static/css/kernel.css" rel="stylesheet" type="text/css">
{% endblock %}
{% block content %}
    <script id="patchset-template" type="text/template">
    {% raw %}
    <div class="patchset">
        <label>Versions</label>
        <div class="versions">
            <% _.each(versions, function(version) { %>
                <span class="version"> <%= version %></span>
            <% }); %>
        </div>
        <label>Patches</label>
        <div class="patches">
            <% _.each(patches, function(patch) { %>
                <a href="<%= patch %>" class="patch" target="_blank"><%= patch %></a>
            <% }); %>
        </div>
    </div>
    {% endraw %}
    </script>

    <div id="status-choices-menu" class="context-menu">
        {% for value, description in status_descriptions.items() %}
            <div data-description="{{ description }}" data-value="{{ value }}">
                {{ description }}
            </div>
        {% endfor %}
    </div>

    <div id="edit-kernel-dialog" class="dialog">
        <div class="title">Edit kernel</div>
        <div class="content">
            <div class="input-group">
                <label>Deprecated</label>
                <div class="switch">
                    <input id="deprecated" type="checkbox">
                    <label for="deprecated"></label>
                </div>
            </div>
            <div class="input-group">
                <label>Branches</label>
                <input class="branches" type="text">
                <span class="note">Must be a space-separated list of name=version pairs.</span>
            </div>
            <div class="input-group">
                <label>Default branch</label>
                <input class="default-branch" type="text">
            </div>
        </div>
        <div class="actions">
            <button class="cancel">CANCEL</button>
            <button class="save">SAVE</button>
        </div>
    </div>

    <div id="import-statuses-dialog" class="dialog">
        <div class="title">Import statuses</div>
        <div class="content">
            <div class="input-group">
                <label>From repo</label>
                <input class="repo" placeholder="android_kernel_vendor_device" type="text">
            </div>
            <div class="input-group">
                <label>From branch</label>
                <input class="branch" placeholder="cm-14.1" type="text">
            </div>
            <div class="input-group">
                <label>Override all</label>
                <div class="switch">
                    <input id="override" type="checkbox">
                    <label for="override"></label>
                </div>
                <p class="note">
                    By default, the imported statuses will only override unpatched statuses.<br>
                    Enable to override all.
                </p>
            </div>
        </div>
        <div class="actions">
            <button class="cancel">CANCEL</button>
            <button class="import">IMPORT</button>
        </div>
    </div>

    <div id="patchset-dialog" class="dialog">
        <div class="title">
            <span data-for-state="add">Add Patchset</span>
            <span data-for-state="edit">Edit Patchset</span>
        </div>
        <div class="content">
            <div class="input-group">
                <label>Versions</label>
                <input class="versions" placeholder="...">
                <span class="note">Must be a space separated list of kernel versions.</span>
            </div>
            <div class="input-group">
                <label>Patches</label>
                <textarea class="patches" placeholder="..."></textarea>
                <span class="note">Must be a new line separated list of links to raw patches.</span>
            </div>
        </div>
        <div class="actions">
            <button class="cancel">CANCEL</button>
            <button class="add" data-for-state="add">ADD</button>
            <button class="save" data-for-state="edit">EDIT</button>
        </div>
    </div>

    <div id="add-cve-dialog" class="dialog">
        <div class="title">Add CVE</div>
        <div class="content">
            <div class="input-group">
                <label>Name</label>
                <input class="name" placeholder="CVE-20YY-XXXX" type="text">
            </div>
            <div class="input-group">
                <label>Notes</label>
                <textarea class="notes" placeholder="..."></textarea>
            </div>
            <div class="input-group">
                <label>Tags</label>
                <input class="tags" placeholder="..." type="text">
                <span class="note">Must be a space separated list of words.</span>
            </div>
            <div class="input-group">
                <div class="patchsets"></div>
                <button class="patchset-dialog-triggers" data-open-state="add">ADD PATCHSET</button>
            </div>
        </div>
        <div class="actions">
            <button class="cancel">CANCEL</button>
            <button class="add">ADD</button>
        </div>
    </div>

    <div id="cve-info-dialog" class="dialog">
        <div class="title">
            <div class="name">CVE-20YY-XXX</div>
            <div class="score">-1</div>
        </div>
        <div class="content">
            <div class="input-group">
                <label>Notes</label>
                <textarea class="notes" placeholder="No notes specified." disabled="true"></textarea>
            </div>
            <div class="input-group">
                <label>Tags</label>
                <input class="tags" placeholder="No tags specified." disabled="true" type="text">
            </div>
            <div class="input-group">
                <div class="patchsets"></div>
            </div>
        </div>
        <div class="actions">
            <button class="cancel">CANCEL</button>
        </div>
    </div>

    <div class="card container">
        <div class="header">
            <span class="title">
                {{ kernel.vendor }}/{{ kernel.device }}
                <a href="https://github.com/{{ org }}/{{ kernel.repo_name }}"
                        target="_blank" title="View on GitHub">
                    <i class="mdi mdi-github-circle"></i>
                </a>
            </span>
            <div id="branches" class="selectable">
                {% for branch in kernel.branches %}
                    <a href="{{ branch.name }}"
                    {% if branch.name == active_branch.name %}
                        class="active"
                    {% endif %}
                    >
                        {{ branch.name }}
                    </a>
                {% endfor %}
            </div>
            <div id="percentage" class="progress-bar"
                    data-value="{{ active_branch.percentage }}">
                <div class="progress-bar-inner"></div>
                <div class="progress-value"></div>
            </div>
        </div>
        <div class="actions">
            <button id="edit-kernel-dialog-trigger">EDIT KERNEL</button>
            <button id="import-statuses-dialog-trigger">IMPORT STATUSES</button>
            <button id="add-cve-dialog-trigger">ADD CVE</button>
        </div>
    </div>
    <div class="card container">
        <div id="cves-container">
            {% for cve in cves %}
                <div class="cve">
                    <span class="severity" data-score="{{ cve.score }}"></span>
                    <span class="name" data-name="{{ cve.name }}">{{ cve.name }}</span>
                    <span class="status"
                            data-name="{{ cve.name }}" data-value="{{ statuses[cve.name] }}">
                        {{ status_descriptions[statuses[cve.name]] }}
                    </span>
                </div>
            {% endfor %}
        </div>
    </div>
{% endblock %}
{% block latescripts %}
    <script src="/static/js/kernel.js"></script>
{% endblock %}