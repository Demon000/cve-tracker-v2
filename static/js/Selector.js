(function() {
	function isDefined(value) {
		return typeof value != 'undefined';
	}

	function Selector(o) {
		var s = this;

		s.emitter = new EventEmitter();

		var options = {};
		var multiple = false;

		s.isActive = function(op) {
			return options[op].classList.contains('active');
		};

		s.isOption = function(op) {
			return isDefined(options[op]);
		};

		function _getActive(asArray) {
			var actives = [];
			for (var op in options) {
				if (s.isActive(op)) {
					actives.push(op);
				}
			}
			return asArray ? actives : actives[0];
		}

		s.getActive = function() {
			return _getActive(false);
		};

		s.getActives = function() {
			return _getActive(true);
		};

		s.getActiveMap = function() {
			var map = {};
			for (var op in options) {
				map[op] = s.isActive(op);
			}
			return map;
		};

		function _setActive(op, value) {
			if (!s.isOption(op) || value == s.isActive(op)) {
				return;
			}

			if (value) {
				options[op].classList.add('active');
			} else {
				options[op].classList.remove('active');
			}
		}

		s.setActive = function(op, value, emit) {
			if (multiple) {
				_setActive(op, value);
			} else {
				if (value) {
					_setActive(s.getActive(false), false);
					_setActive(op, true);
				}
			}
			if (emit) {
				s.emitter.emit('activeChange', op, value);
				s.emitter.emit('activesChange', s.getActives());
			}
		};

		s.setActives = function(ops, value) {
			ops.forEach(function(op) {
				s.setActive(op, value, false);
			});
			s.emitter.emit('activesChange', s.getActives());
		};

		s.setActiveMap = function(ops) {
			for (var i in ops) {
				s.setActive(i, ops[i], false);
			}
			s.emitter.emit('activesChange', s.getActives());
		};

		s.toggleActive = function(op) {
			s.setActive(op, !s.isActive(op), true);
		};

		s.addOption = function(op, el) {
			el.addEventListener('click', function() {
				s.toggleActive(op);
			});
			options[op] = el;
		};

		s.getOptions = function() {
			return options;
		};

		s.getOptionsValue = function() {
			var values = [];
			for (var i in options) {
				values.push(i);
			}
			return values;
		};

		s.setOptions = function(newOptions) {
			options = {};
			for (var i in newOptions) {
				s.addOption(i, newOptions[i]);
			}
		};

		if (o.options) {
			s.setOptions(o.options);
		}

		if (o.multiple) {
			multiple = o.multiple;
		}
	}

	window.Selector = Selector;
})();
