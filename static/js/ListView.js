(function() {
    function stringToElement(s) {
        var div = document.createElement('div');
        div.innerHTML = s;
        return div.children[0];
    }

    function ListView(o) {
        var lv = this;
        var container = o.container;
        var template = _.template(o.template);
        var list = [];

        lv.getData = function() {
            return list;
        };

        lv.getElements = function() {
            return list.map(function(data) {
                return data._element;
            });
        };

        lv.render = function(data) {
            var s = template(data);
            return stringToElement(s);
        };

        lv.empty = function() {
            var child;
            while (child = container.firstChild) {
                container.removeChild(child);
            }
        };

        lv.add = function(data) {
            var element = lv.render(data);
            data._element = element;
            container.appendChild(element);
            list.push(data);
            return element;
        };

        lv.refresh = function() {
            lv.empty();
            list.forEach(lv.add);
            return lv.getElements();
        };

        lv.set = function(data) {
            list = data;
            return lv.refresh();
        };

        if (o.data) {
            lv.set(o.data);
        }
    }
    window.ListView = ListView;
})();