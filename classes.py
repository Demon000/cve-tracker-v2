from mongoengine import *

StatusChoices = [1, 2, 3, 4, 5, 6]
StatusDescriptions = {
    1: 'unpatched',
    2: 'patched',
    3: 'unaffected',
    4: 'upstream hold',
    5: 'on gerrit',
    6: 'update available'
}

BranchNames = ['cm-13.0', 'cm-14.1', 'lineage-15.0']
KernelVersions = ['3.10', '3.4', '3.10', '3.18', '4.4', '4.9']

DeprecatedMap = {
    -1: [True, False, None],
    0: [False, None],
    1: [True]
}

class Patchset(EmbeddedDocument):
    versions = ListField(StringField, choices=KernelVersions, required=True)
    patches = ListField(URLField, required=True)

class Cve(Document):
    name = StringField(required=True, unique=True)
    notes = StringField(default='')
    score = IntField(min_value=0, max_value=10, required=True)
    tags = ListField(StringField, default=[])
    patchsets = EmbeddedDocumentListField(Patchset, default=[])

class Branch(EmbeddedDocument):
    name = StringField(required=True, choices=BranchNames)
    version = StringField(required=True, choices=KernelVersions)

class Kernel(Document):
    repo = StringField(required=True, unique=True)
    vendor = StringField(required=True)
    device = StringField(required=True)
    deprecated = BooleanField(default=False)
    branches = EmbeddedDocumentListField(Branch, default=[])

class Status(Document):
    value = IntField(required=True, choices=StatusChoices)
    cve = ReferenceField(Cve, required=True, reverse_delete_rule=CASCADE)
    kernel = ReferenceField(Kernel, required=True, reverse_delete_rule=CASCADE)
    branch = StringField(required=True, choices=BranchNames)
