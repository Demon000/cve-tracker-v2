from flask import Blueprint, render_template, request
from classes import *

web = Blueprint('web', __name__,
        template_folder='templates', static_folder='static')

def render_error(message):
    return render_template('error.html',
            message=message)

@web.route('/', methods=['GET'])
def get_root():
    return render_template('index.html')

def render_kernels(deprecated):
    kernels = Kernel.objects(deprecated=deprecated) \
            .order_by('repo')

    cves_count = Cve.objects.count()
    vendors = {}
    for kernel in kernels:
        if kernel.vendor not in vendors:
            vendors[kernel.vendor] = []
        vendors[kernel.vendor].append(kernel)

        kernel.set_percentages(cves_count)

    return render_template('kernels.html',
            vendors=vendors)

@web.route('/kernels', methods=['GET'])
def get_kernels():
    return render_kernels(False)

